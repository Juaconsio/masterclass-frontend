---
import { Icon } from 'astro-icon/components';

const links = [
  { href: '/', label: 'Inicio' },
  { href: '/about', label: 'Nosotros' },
  { href: '/courses', label: 'Cursos' },
  { href: '#how-it-works', label: 'Reservas' },
  { href: '/#contact', label: 'Contacto' },
];

const authLinks = [
  { href: '/ingresar', label: 'Iniciar Sesión', showOnDesktop: true },
  { href: '/registro', label: 'Registrarse', showOnDesktop: false },
  { href: '/recuperar', label: 'Recuperar Contraseña', showOnDesktop: false },
];
---

<!-- Navbar principal -->
<nav
  class="navbar h-navbar px-12 fixed top-0 w-full bg-primary/80 backdrop-blur border-b border-base-300 z-50"
>
  <!-- Mobile: Botón menú principal (izquierda) -->
  <div class="flex-none lg:hidden">
    <label for="main-drawer" aria-label="open main menu" class="btn btn-navbar btn-square">
      <Icon name="mdi:menu" size={32} />
    </label>
  </div>

  <!-- Logo/título -->
  <div class="flex-1 lg:flex-none">
    <a
      href="/"
      class="btn btn-navbar normal-case text-xl font-bold tracking-wide justify-center lg:justify-start"
    >
      <Icon name="mdi:school" size={32} class="mr-2" />
      <span>Salva Ramos</span>
    </a>
  </div>

  <!-- Desktop: Menú de navegación (centro) -->
  <div class="hidden lg:flex lg:flex-1 lg:justify-center">
    <ul class="menu menu-horizontal">
      {
        links.map((link) => (
          <li>
            <a data-navlink href={link.href} class="text-lg font-medium">
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </div>

  <!-- Desktop: AuthLinks + Icono cuenta (derecha) -->
  <div class="flex items-center gap-2">
    <!-- Desktop: Links de autenticación -->
    <div class="hidden lg:flex">
      <ul class="menu menu-horizontal">
        {
          authLinks
            .filter((link) => link.showOnDesktop)
            .map((link) => (
              <li>
                <a data-navlink href={link.href} class="text-lg font-medium">
                  {link.label}
                </a>
              </li>
            ))
        }
      </ul>
    </div>

    <!-- Icono cuenta (siempre visible) -->
    <label for="auth-drawer" aria-label="open auth menu" class="btn btn-navbar btn-square">
      <Icon name="mdi:account" size={32} />
    </label>
  </div>
</nav>

<!-- Drawer 1: Menú principal -->
<div class="drawer z-60">
  <input id="main-drawer" type="checkbox" class="drawer-toggle" />
  <div class="drawer-content"></div>
  <div class="drawer-side">
    <label for="main-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
    <ul class="menu bg-base-200 min-h-full w-80 p-4">
      <li class="menu-title">
        <span>Navegación</span>
      </li>
      {
        links.map((link) => (
          <li>
            <a data-navlink href={link.href} class="text-lg font-medium">
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</div>

<!-- Drawer 2: Menú de autenticación -->
<div class="drawer drawer-end z-60">
  <input id="auth-drawer" type="checkbox" class="drawer-toggle" />
  <div class="drawer-content"></div>
  <div class="drawer-side">
    <label for="auth-drawer" aria-label="close auth menu" class="drawer-overlay"></label>
    <ul class="menu bg-base-200 min-h-full w-80 p-4">
      <li class="menu-title">
        <span>Cuenta</span>
      </li>
      {
        authLinks.map((link) => (
          <li>
            <a href={link.href} class="text-lg font-medium">
              {link.label}
            </a>
          </li>
        ))
      }
      <div class="divider"></div>
      <li>
        <a href="/courses" class="btn btn-primary"> Explora los cursos </a>
      </li>
    </ul>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const currentPath = window.location.pathname;
    const currentHash = window.location.hash;
    const current = currentPath.concat(currentHash);
    const links = document.querySelectorAll('[data-navlink]');
    links.forEach((el) => {
      const href = el.getAttribute('href');
      if (href === current) {
        el.classList.add('active');
        el.setAttribute('aria-current', 'page');
      } else {
        el.classList.remove('active');
        el.removeAttribute('aria-current');
      }
    });
  });
</script>
