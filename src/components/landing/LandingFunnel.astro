---
import Navbar from './Navbar.astro';
import Hero from './Hero.astro';
import FeaturedCourses from './FeaturedCourses.astro';
import AboutUs from './AboutUs.astro';
import ReviewsSection from './ReviewsSection.astro';
import Problems from './Problems.astro';
import Functionalities from './Functionalities.astro';
import HowItWorks from './HowItWorks.astro';
import Pricing from './Pricing.astro';
import CommunityBlog from './CommunityBlog.astro';
import CTA from './CTA.astro';
import Footer from './footer.astro';
import { getCollection } from 'astro:content';
import { getPublicCourseCatalog } from '@/lib/courseCatalog';

const allCourses = await getPublicCourseCatalog();
const allReviews = await getCollection('reviews');

const featuredCourses = allCourses.filter((course) => course.data.featured);
const coursesToShow =
  featuredCourses.length >= 3 ? featuredCourses.slice(0, 3) : allCourses.slice(0, 3);

const featuredReviewsFiltered = allReviews.filter((review) => review.data.featured);
const reviewsToShow =
  featuredReviewsFiltered.length >= 6
    ? featuredReviewsFiltered.slice(0, 6)
    : allReviews.slice(0, 6);

const reviewsData = reviewsToShow.map((review) => ({
  id: review.data.id,
  name: review.data.name,
  profile: review.data.profile,
  studies: review.data.studies,
  comment: review.data.comment,
  course: review.data.course,
  rating: review.data.rating,
  image: review.data.image,
  date: review.data.date,
}));
---

<div>
  <Navbar />

  <!-- Hero Section -->
  <Hero />

  <!-- <Stats /> -->

  <Problems />

  <AboutUs />

  <Functionalities />

  <HowItWorks />

  <FeaturedCourses courses={coursesToShow} />
  <Pricing />
  <ReviewsSection reviews={reviewsData} />
  <CommunityBlog />

  <CTA />
  <Footer />
</div>
