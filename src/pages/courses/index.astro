---
import { getCollection } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import Navbar from '@components/landing/Navbar.astro';
import CourseCard from '@components/landing/courses/CourseCard.astro';
import CourseFilters from '@components/landing/courses/CourseFilters.astro';
import { Icon } from 'astro-icon/components';
// Get all static course content
const courses = await getCollection('courses');

// Extract unique values for filters
const departments = [...new Set(courses.map((course) => course.data.department))];
const levels = [...new Set(courses.map((course) => course.data.level))];

// Sort courses: featured first, then by department
const sortedCourses = courses.sort((a, b) => {
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  return a.data.department.localeCompare(b.data.department, 'es');
});
---

<Layout title="Cursos Disponibles - TutorÃ­a Universitaria">
  <Navbar />
  <!-- Hero Section -->

  <div class="container mx-auto px-4 py-6 lg:py-8 mt-16">
    {
      courses.some((course) => course.data.featured) && (
        <div class="mb-4">
          <div class="alert alert-accent shadow-lg text-sm lg:text-base">
            <svg class="stroke-current shrink-0 w-5 h-5 lg:w-6 lg:h-6" fill="none" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            <span>
              Â¡Revisa nuestros cursos destacados! Estos son especialmente recomendados por nuestros
              tutores expertos.
            </span>
          </div>
        </div>
      )
    }
    <!-- Filters Section -->
    <CourseFilters departments={departments} levels={levels} courses={sortedCourses} />

    <!-- Featured Courses Banner -->

    <!-- Course Grid -->
    <div class="course-grid-container">
      <div
        id="course-grid"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-6"
      >
        {sortedCourses.map((course) => <CourseCard course={course} />)}
      </div>

      <!-- Empty state -->
      <div id="empty-state" class="hidden text-center py-12">
        <div class="text-5xl lg:text-6xl mb-4">ðŸ“š</div>
        <h3 class="text-xl lg:text-2xl font-bold text-base-content mb-2">No se encontraron cursos</h3>
        <p class="text-base-content/70 mb-4 lg:mb-6 text-sm lg:text-base">Intenta ajustar los filtros para ver mÃ¡s cursos.</p>
        <button id="clear-filters" class="btn btn-primary btn-sm lg:btn-md"> Limpiar Filtros </button>
      </div>
    </div>

    <div role="alert" class="alert my-6 lg:my-8 shadow-lg text-sm lg:text-base">
      <Icon name="mdi:message-alert" size={24} class="text-secondary lg:w-8 lg:h-8" />
      <span> Â¿No encuentras el curso que necesitas?</span>
      <div>
        <button class="btn btn-xs lg:btn-sm btn-secondary">Avisanos</button>
      </div>
    </div>
  </div>

  <style>
    .course-grid-container {
      min-height: 400px;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .course-card {
      animation: fadeInUp 0.5s ease-out;
    }

    /* Stagger animation for course cards */
    .course-card:nth-child(1) {
      animation-delay: 0.1s;
    }
    .course-card:nth-child(2) {
      animation-delay: 0.2s;
    }
    .course-card:nth-child(3) {
      animation-delay: 0.3s;
    }
    .course-card:nth-child(4) {
      animation-delay: 0.4s;
    }

    /* Respect prefers-reduced-motion */
    @media (prefers-reduced-motion: reduce) {
      .course-card {
        animation: none;
      }
    }
  </style>
</Layout>
